var idPrograma,token=$("meta[name='_csrf']").attr("content");function guardarPrograma(){limpiarErrores();var e=$("#codigo").val(),r=$("#programa").val(),a=document.getElementById("select_facultad_programa").value,t=document.getElementById("select_director_programa").value,o={};o.id=idPrograma,o.codigo=e,o.programa=r,"0"!=a&&(o.facultad={},o.facultad.id=a),"0"!=t&&(o.directorPrograma={},o.directorPrograma.id=t);var i=validateSelect("select_facultad_programa","errorSelectFacultad"),c=validateSelect("select_director_programa","errorSelectDirectorPrograma"),n=validateInputTextRequerido("programa","errorPrograma"),d=validateInputTextRequerido("codigo","errorCodigo"),l=validateLengthTxt("programa","errorPrograma",80),s=validateLengthTxt("codigo","errorCodigo",3);i&&c&&n&&d&&l&&s&&0!=a&&0!=t?(showSpinnerModal("btnSaveAreas","btnSpinnerAreas"),$.ajax({headers:{"X-CSRF-TOKEN":token},type:"POST",contentType:"application/json; charset=utf-8",data:JSON.stringify(o),url:contextPath+"/programas-academicos/save",cache:!1,success:function(e){toastr.success("Se ha guardado la información","Excelente!"),idPrograma=0,paginadorLoadAjax(contextPath+"/programas-academicos/reload"),$("#modalRegistroPrograma").modal("hide"),$("#select_facultad_filtro_programa").val(0),hideSpinnerModal("btnSaveAreas","btnSpinnerAreas")},error:function(e){hideSpinnerModal("btnSaveAreas","btnSpinnerAreas"),e.responseJSON.length>0?(toastr.error("No se pudo procesar la solicitud...","Error!"),e.responseJSON.forEach(function(e){if("programa"==e.field){var r=document.getElementById("programa");document.getElementById("errorPrograma").innerText=e.defaultMessage,r.classList.add("is-invalid")}if("codigo"==e.field){var a=document.getElementById("codigo");document.getElementById("errorCodigo").innerText=e.defaultMessage,a.classList.add("is-invalid")}if("facultad"==e.field){var t=document.getElementById("select_facultad_programa");document.getElementById("errorSelectFacultad").innerText=e.defaultMessage,t.classList.add("has-error")}if("directorPrograma"==e.field){var o=document.getElementById("select_director_programa");document.getElementById("errorSelectDirectorPrograma").innerText=e.defaultMessage,o.classList.add("has-error")}})):toastr.error(e.responseJSON.message,"Error!")}})):toastr.error("Diligencie el formulario correctamente, los campos son requeridos","Error!")}function editarPrograma(e){$.ajax({headers:{"X-CSRF-TOKEN":token},type:"GET",contentType:"application/json; charset=utf-8",url:contextPath+"/programas-academicos/search/"+e.dataset.id,cache:!1,success:function(e){$("#modalRegistroPrograma").modal(),idPrograma=e.id,$("#codigo").val(e.codigo),$("#programa").val(e.programa),$("#select_facultad_programa").val(e.idFacultad),$("#select_facultad_programa").select2().trigger("change"),null!=e.idDirector&&$("#select_director_programa").val(e.idDirector),$("#select_director_programa").select2().trigger("change")},error:function(e){toastr.error(e.responseJSON.message,"Error!")}})}function limpiarErrores(){var e=document.getElementById("select_facultad_programa");document.getElementById("errorSelectFacultad").innerText="",e.classList.remove("has-error");var r=document.getElementById("select_director_programa");document.getElementById("errorSelectDirectorPrograma").innerText="",r.classList.remove("has-error");var a=document.getElementById("codigo");document.getElementById("errorCodigo").innerText="",a.classList.remove("is-invalid");var t=document.getElementById("programa");document.getElementById("errorPrograma").innerText="",t.classList.remove("is-invalid")}toastr.options={closeButton:!0,debug:!1,newestOnTop:!1,progressBar:!1,positionClass:"toast-bottom-right",preventDuplicates:!1,onclick:null,showDuration:"300",hideDuration:"1000",timeOut:"5000",extendedTimeOut:"1000",showEasing:"swing",hideEasing:"linear",showMethod:"fadeIn",hideMethod:"fadeOut"},$(document).ready(function(){$("#modalRegistroPrograma").on("show.bs.modal",function(e){$("#codigo").val(""),$("#programa").val(""),$("#select_facultad_programa").val(0).trigger("change"),$("#select_director_programa").val(0).trigger("change"),idPrograma=0,limpiarErrores()}),$("#select_facultad_filtro_programa").on("change",function(e){e.preventDefault();var r=$(this).find("option:selected").text();if(0==$(this).find("option:selected").val())paginadorLoadAjax(contextPath+"/programas-academicos/reload");else{var a=contextPath+"/programas-academicos/reload?facultad=".concat(r.replace(/ /gi,"%20"));paginadorLoadAjax(a)}}),$("#select_director_programa").on("change",function(e){e.preventDefault();var r=$(this).find("option:selected").text(),a=(r={id:$(this).find("option:selected").val(),idP:idPrograma},document.getElementById("alertDirector"));a.innerText="",a.style.display="none",toastr.clear(),$.ajax({headers:{"X-CSRF-TOKEN":token},type:"GET",url:contextPath+"/programas-academicos/search-director?"+$.param(r),dataType:"json",contentType:"application/json; charset=utf-8",cache:!1,success:function(e){null!=e.programa&&(a.innerText="El/La docente ya es director del programa "+e.programa+" y sería desvinculado.",a.style.display="inline")}})}),$("#select_facultad_programa").on("change",function(e){e.preventDefault(),validateSelect("select_facultad_programa","errorSelectFacultad")}),$("#select_director_programa").on("change",function(e){e.preventDefault(),validateSelect("select_director_programa","errorSelectDirectorPrograma")})});