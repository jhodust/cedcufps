var nombre,
    fechaInicio,
    fechaFin,
    duracion,
    fechaLimInscripcion,
    cantMaxParticipantes,
    costoInscripcion,
    lugar,
    costoEducacionContinua,
    requisitos,
    objetivo,
    porcentajeAsistencia,
    resumen,
    contenidoGeneral,
    idTipoEduContinua,
    tipoEduContinua,
    idProgramaResponsable,
    idDocenteResponsable,
    idClasificacionCine,
    consecutivo,
    token = $("meta[name='_csrf']").attr("content");
function validDuracion(e) {
    var a = $("#selectTipoContinua").find("option:selected"),
        n = document.getElementById("duracion"),
        i = document.getElementById("errDuracionEdc"),
        t = document.getElementById("btnGuardarEdC");
    return 1 == a.val() || 4 == a.val()
        ? e.trim() < 16
            ? ((i.innerText = "El " + a.text() + " debe tener mínimo 16 horas de duración"), n.classList.add("is-invalid"), (t.disabled = !0), !1)
            : ((i.innerText = ""), n.classList.remove("is-invalid"), (t.disabled = !1), !0)
        : 2 == a.val()
        ? e.trim() < 90
            ? ((i.innerText = "El " + a.text() + " debe tener mínimo 90 horas de duración"), n.classList.add("is-invalid"), (t.disabled = !0), !1)
            : ((i.innerText = ""), n.classList.remove("is-invalid"), (t.disabled = !1), !0)
        : "" == e.trim()
        ? ((i.innerText = "El campo es requerido"), n.classList.add("is-invalid"), (t.disabled = !0), !1)
        : ((i.innerText = ""), n.classList.remove("is-invalid"), (t.disabled = !1), !0);
}
$(document).ready(function () {
    $("#selectEdCBase").on("select2:select", function (e) {
        findEducacionContinuaBase(e.params.data.id);
    }),
        $("#selectProgramaBase").on("select2:select", function (e) {
            loadListEduContinuaBase(e.params.data.id);
        }),
        $("#selectTipoContinua").select2({
            tags: !0,
            createTag: function (e) {
                return { id: -1, text: e.term, newTag: !0 };
            },
        }),
        $("#selectTipoContinua").on("change", function (e) {
            e.preventDefault(), validateSelect("selectTipoContinua", "errTipoEdc");
            var a = $(this).find("option:selected"),
                n = document.getElementById("duracion"),
                i = document.getElementById("errDuracionEdc"),
                t = document.getElementById("btnGuardarEdC");
            "1" == a.val() || "4" == a.val()
                ? n.value < 16 && ((i.innerText = "El " + a.text() + " debe tener mínimo 16 horas de duración"), n.classList.add("is-invalid"), (t.disabled = !0))
                : 2 == a.val()
                ? n.value < 90 && ((i.innerText = "El " + a.text() + " debe tener mínimo 90 horas de duración"), n.classList.add("is-invalid"), (t.disabled = !0))
                : ((i.innerText = ""), n.classList.remove("is-invalid"), (t.disabled = !1));
        }),
        $("#selectClasificacionCINE").on("change", function (e) {
            e.preventDefault(), validateSelect("selectClasificacionCINE", "errClasificacionEdc");
        }),
        $("#programaResponsable").on("change", function (e) {
            e.preventDefault(), validateSelect("programaResponsable", "errProgRespEdc");
        }),
        $("#docenteResponsable").on("change", function (e) {
            e.preventDefault(), validateSelect("docenteResponsable", "errDocRespEdc");
        }),
        $("#selectTipoBeneficiarios").on("change", function (e) {
            e.preventDefault(), validateSelect("selectTipoBeneficiarios", "errTipoBenefEdc");
        }),
        $("#duracion").keyup(function (e) {
            validDuracion(e.target.value);
        }),
        $("#fechaLimInscripcionEduCont").flatpickr({
            enableTime: !0,
            dateFormat: "d/m/Y H:i",
            minDate: null != fLim && new Date(fLim) < new Date() ? new Date(fLim) : new Date(),
            defaultDate: fechaLimInscripcionEvento,
            maxDate: fechaFinEvento,
        });
    var e = [];
    e.push(new Date()),
        e.push(fIni),
        $("#fechaInicioEduCont").flatpickr({
            enableTime: !0,
            dateFormat: "d/m/Y H:i",
            minDate: null != fIni && new Date(fIni) < new Date() ? new Date(fIni) : new Date(),
            defaultDate: fechaInicioEvento,
            plugins: [new rangePlugin({ input: "#fechaFinEduCont", enableTime: !0, dateFormat: "d/m/Y H:i", defaultDate: fechaFinEvento })],
            onChange: function (e, a, n) {
                $("#fechaLimInscripcionEduCont").flatpickr({
                    enableTime: !0,
                    dateFormat: "d/m/Y H:i",
                    defaultDate: fechaLimInscripcionEvento,
                    minDate: null != fLim && new Date(fLim) < new Date() ? new Date(fLim) : new Date(),
                    maxDate: e[1].toLocaleDateString(),
                });
            },
        }),
        $("#cbEdCExistente").click(function () {
            document.getElementById("cbEdCExistente").checked
                ? (document.getElementById("divEdCBase").style.display = "block")
                : ($("#selectProgramaBase").val("0").trigger("change"), clearSelectEduContinuaBase(), clearEduContinuaBase(), (document.getElementById("divEdCBase").style.display = "none")),
                clearErrors();
        });
});
var idTipoBeneficiarios = [];
function showLoader() {
    try {
        (document.getElementById("divLoader").style.display = "flex"), (document.getElementById("formEducacionContinua").style.display = "none"), (document.getElementById("formEducacionContinuaBase").style.display = "none");
    } catch (e) {}
}
function hideLoader() {
    try {
        (document.getElementById("divLoader").style.display = "none"), (document.getElementById("formEducacionContinua").style.display = "inline"), (document.getElementById("formEducacionContinuaBase").style.display = "inline");
    } catch (e) {}
}
function guardarEdc() {
    ajaxSaveEducacionContinua();
}
function ajaxSaveEducacionContinua() {
    (listTipoBen = []),
        $("#selectTipoBeneficiarios")
            .val()
            .forEach((e) => {
                listTipoBen.push(e);
            }),
        (idTipoBeneficiarios = listTipoBen);
    var e,
        a,
        n = $("#nombreEdc").val(),
        i = $("#fechaInicioEduCont").val(),
        t = $("#fechaFinEduCont").val(),
        c = $("#duracion").val(),
        o = $("#fechaLimInscripcionEduCont").val(),
        r = $("#cantMaxPartEdc").val(),
        d = $("#costoInscripcionEdc").val(),
        l = $("#lugarEdc").val(),
        s = $("#costoTotalEdc").val(),
        u = $("#porcentajeAsistenciaEdc").val(),
        p = $("#selectTipoContinua").select2("data")[0].id,
        E = $("#selectTipoContinua").select2("data")[0].text;
    (e = null != document.getElementById("programaResponsable") ? $("#programaResponsable").val() : eduContinua.idProgramaResp),
        (a = null != document.getElementById("docenteResponsable") ? $("#docenteResponsable").val() : eduContinua.idDocenteResp);
    var m,
        f = $("#selectClasificacionCINE").val(),
        v = $("#infoAdicionalEdC").val(),
        g = validateInputTextRequerido("nombreEdc", "errNombreEdc"),
        C = validateLengthTxt("nombreEdc", "errNombreEdc", 150),
        h = validateInputTextRequerido("fechaInicioEduCont", "errFechaInicioEdc"),
        T = validateInputTextRequerido("fechaFinEduCont", "errFechaFinEdc"),
        b = validateInputTextRequerido("fechaLimInscripcionEduCont", "errFechaLimInscEdc"),
        I = validateInputNumberRequerido("duracion", "errDuracionEdc"),
        B = validateInputNumberRequerido("costoTotalEdc", "errCostoTotalEdc"),
        y = validDuracion(c),
        D = validateInputNumberNotRequired("costoInscripcionEdc", "errCostoInscripEdc"),
        R = validateInputNumberNotRequired("cantMaxPartEdc", "errCantPartEdc"),
        x = validateInputPorcentaje("porcentajeAsistenciaEdc", "errPorcAsisEdc"),
        L = validateInputTextRequerido("lugarEdc", "errLugarEdc"),
        S = validateLengthTxt("lugarEdc", "errLugarEdc", 40),
        w = validateSelect("selectTipoContinua", "errTipoEdc"),
        F = validateSelect("selectTipoBeneficiarios", "errTipoBenefEdc"),
        P = validateSelect("selectClasificacionCINE", "errClasificacionEdc");
    
    null != document.getElementById("programaResponsable") && (m = validateSelect("programaResponsable", "errProgRespEdc")),
        null != document.getElementById("docenteResponsable") && (N = validateSelect("docenteResponsable", "errDocRespEdc"));
    var N = validateSelect("docenteResponsable", "errDocRespEdc");
    if (g && C && h && T && b && I && y && B && D && R && x && L && S && w && F && P && (null == m || m) && (null == N || N)) {
        var j = $("#inputImagenEvento")[0].files,
            A = new FormData();
        A.append("imagen", j[0]),
            A.append("id", idEduContinua),
            A.append("nombre", n),
            A.append("fechaInicio", i),
            A.append("fechaFin", t),
            A.append("duracion", c),
            A.append("fechaLimInscripcion", o),
            "" != r.trim() && A.append("cantMaxParticipantes", r),
            "" != d.trim() && A.append("costoInscripcion", d),
            A.append("lugar", l),
            A.append("costoEducacionContinua", s),
            A.append("porcentajeAsistencia", u),
            A.append("idTipoEduContinua", p),
            A.append("tipoEduContinua", E),
            A.append("idProgramaResponsable", e),
            A.append("idDocenteResponsable", a),
            A.append("idClasificacionCine", f),
            A.append("idTipoBeneficiarios", idTipoBeneficiarios),
            A.append("infoAdicional", v),
            null != consecutivo && A.append("consecutivo", consecutivo),
            showSpinnerModal("btnGuardarEdC", "btnSpinnerEdC"),
            $.ajax({
                headers: { "X-CSRF-TOKEN": token },
                url: contextPath + "/educacion-continua/save",
                type: "POST",
                data: A,
                enctype: "multipart/form-data",
                processData: !1,
                contentType: !1,
                cache: !1,
                success: function (e) {
                    toastr.success("Se ha guardado la información", "Excelente!"),
                        0 == idEduContinua
                            ? window.setTimeout(function () {
                                  window.location.href = contextPath + "/educacion-continua";
                              }, 1e3)
                            : (reloadDetalles(), hideSpinnerModal("btnGuardarEdC", "btnSpinnerEdC"), $('[href="#pills-detalles"]').tab("show"));
                },
                error: function (e) {
                    hideSpinnerModal("btnGuardarEdC", "btnSpinnerEdC"),
                        e.responseJSON.length > 0
                            ? (toastr.error("No se pudo procesar la solicitud...", "Error!"),
                              e.responseJSON.forEach(function (e) {
                                  if ("facultad" == e.field) {
                                      var a = document.getElementById("facultad");
                                      (document.getElementById("errorFacultad").innerText = e.defaultMessage), a.classList.add("is-invalid");
                                  }
                              }))
                            : toastr.error(e.responseJSON.message, "Error!");
                },
            });
    } else toastr.error("Debes diligenciar el formulario correctamente", "Error!");
}
function findEducacionContinuaBase(e) {
    $.ajax({
        headers: { "X-CSRF-TOKEN": token },
        url: contextPath + "/educacion-continua/search-base",
        type: "GET",
        data: { nombreEdC: e },
        contentType: "application/json; charset=utf-8",
        cache: !1,
        success: function (e) {
            loadEduContinuaBase(e);
        },
        error: function (e) {},
    });
}
function loadListEduContinuaBase(e) {
    clearSelectEduContinuaBase(),
        $.ajax({
            headers: { "X-CSRF-TOKEN": token },
            url: contextPath + "/educacion-continua/search-educaciones-continuas-base",
            type: "GET",
            data: { idPrograma: e },
            contentType: "application/json; charset=utf-8",
            cache: !1,
            success: function (e) {
                e.forEach(function (e) {
                    var a = new Option(e, e, !1, !1);
                    $("#selectEdCBase").append(a);
                });
            },
            error: function (e) {},
        });
}
function clearSelectEduContinuaBase() {
    $("#selectEdCBase").empty().trigger("change");
    var e = new Option("Seleccione...", "0", !1, !1);
    $("#selectEdCBase").append(e).trigger("change");
}
function loadEduContinuaBase(e) {
    if (
        ($("#nombreEdc").val(e.nombre),
        $("#duracion").val(e.duracion),
        $("#costoTotalEdc").val(e.costoEducacionContinua),
        $("#costoInscripcionEdc").val(e.costoInscripcion),
        $("#cantMaxPartEdc").val(e.cantMaxParticipantes),
        $("#porcentajeAsistenciaEdc").val(e.porcentajeAsistencia),
        $("#lugarEdc").val(e.lugar),
        $("#infoAdicionalEdC").summernote("code", e.infoAdicional),
        !e.estadoOficialTipoEducacionContinua)
    ) {
        var a = new Option(e.tipoEduContinua, e.idTipoEduContinua, !1, !1);
        $("#selectTipoContinua").append(a);
    }
    $("#selectTipoContinua").val(e.idTipoEduContinua).trigger("change"),
        $("#selectClasificacionCINE").val(e.idClasificacion).trigger("change"),
        $("#programaResponsable").val(e.idProgramaResp).trigger("change"),
        $("#docenteResponsable").val(e.idDocenteResp).trigger("change");
    var n = [];
    e.tipoBeneficiarios.forEach((e) => n.push(e.id)), $("#selectTipoBeneficiarios").val(n).trigger("change"), (consecutivo = e.consecutivo);
}
function clearEduContinuaBase() {
    $("#nombreEdc").val(""),
        $("#duracion").val(""),
        $("#costoTotalEdc").val(""),
        $("#costoInscripcionEdc").val(""),
        $("#cantMaxPartEdc").val(""),
        $("#porcentajeAsistenciaEdc").val(""),
        $("#lugarEdc").val(""),
        $("#requisitosEdc").val(""),
        $("#objetivoEdc").val(""),
        $("#contenidoGeneralEdc").val(""),
        $("#resumenEdc").val(""),
        $("#selectTipoContinua").val("0").trigger("change"),
        $("#selectClasificacionCINE").val("0").trigger("change"),
        $("#programaResponsable").val("0").trigger("change"),
        $("#selectTipoBeneficiarios").val([]).trigger("change"),
        (consecutivo = void 0);
}
function clearErrors() {
    cleanError("selectTipoContinua", "errTipoEdc"),
        cleanError("nombreEdc", "errNombreEdc"),
        cleanError("selectClasificacionCINE", "errClasificacionEdc"),
        cleanError("fechaInicioEduCont", "errFechaInicioEdc"),
        cleanError("fechaFinEduCont", "errFechaFinEdc"),
        cleanError("duracion", "errDuracionEdc"),
        cleanError("costoTotalEdc", "errCostoTotalEdc"),
        cleanError("programaResponsable", "errProgRespEdc"),
        cleanError("docenteResponsable", "errDocRespEdc"),
        cleanError("selectTipoBeneficiarios", "errTipoBenefEdc"),
        cleanError("fechaLimInscripcionEduCont", "errFechaLimInscEdc"),
        cleanError("costoInscripcionEdc", "errCostoInscripEdc"),
        cleanError("cantMaxPartEdc", "errCantPartEdc"),
        cleanError("porcentajeAsistenciaEdc", "errPorcAsisEdc"),
        cleanError("lugarEdc", "errLugarEdc");
}
function reloadDetalles() {
    var e = contextPath + "/educacion-continua/detalles/reload/" + eduContinua.idAcceso;
    $("#detallesEdC").load(e);
}
