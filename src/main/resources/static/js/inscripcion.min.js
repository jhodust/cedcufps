var ctx,c,token=$("meta[name='_csrf']").attr("content"),meses=["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"];fabric.Object.prototype.objectCaching=!0;var imgTarjeta,imgLogoUfps,offsetQr,canvasInscripcion=new fabric.Canvas("mycanvasInscripcion",{renderOnAddRemove:!0,canvasInscripcionOriginalWidth:800,canvasInscripcionOriginalHeight:800,canvasInscripcionWidth:800,canvasInscripcionHeight:800}),path=window.location.pathname;function createTemplateCanvasInscripcion(){fabric.Image.fromURL(imgTarjeta,function(n){canvasInscripcion.setBackgroundImage(n,canvasInscripcion.renderAll.bind(canvasInscripcion),{scaleX:canvasInscripcion.width/n.width,scaleY:canvasInscripcion.height/n.height})}),fabric.Image.fromURL(imgLogoUfps,function(n){n.scale(.065),canvasInscripcion.add(n.set({left:50,top:50}))})}function buildOptions(){buttonsJson={},listTipoPersonaValidInscripcion.forEach(function(n){var i="btn"+n[1];btnn={},btnn.text=n[1],btnn.value=n[0],buttonsJson[i]=btnn}),swal("Cómo desea realizar la inscripción?",{buttons:buttonsJson}).then(n=>{null!=n&&prepararInscripcion(n)})}function realizarInscripcion(){$("#modalPreinscripcion").modal("show")}function showSpinnerInscripcion(){document.getElementById("btnSpinnerInscripcionForm").style.display="flex",document.getElementById("btnInscripcionForm").style.display="none"}function hideSpinnerInscripcion(){try{document.getElementById("btnSpinnerInscripcionForm").style.display="none",document.getElementById("btnInscripcionForm").style.display="inline"}catch(n){}}function prepararInscripcion(){showSpinnerInscripcion(),ajaxRealizarInscripcion()}function ajaxRealizarInscripcion(){var n=validateSelect("select_perfil_inscripcion","errorPerfilInscripcion"),i=!enableToPay||enableToPay&&validateInputTextRequerido("inputConstanciaPago","errorConstanciaPagoInscripcion"),e=document.getElementById("select_perfil_inscripcion").value;if(!n||!i)return toastr.error("Diligenciar todos los campos requeridos...","Error!"),void hideSpinnerInscripcion();var t=new FormData;t.append("idTipoPersona",e),t.append("idEduContinua",idEduContinua),enableToPay&&t.append("filePago",$("#inputConstanciaPago")[0].files[0]),$.ajax({headers:{"X-CSRF-TOKEN":token},type:"POST",url:contextPath+"/preinscripcion/realizar-inscripcion",data:t,enctype:"multipart/form-data",processData:!1,contentType:!1,success:function(n){creacionTarjetaInscripcion(n)},error:function(n){hideSpinnerInscripcion()}})}function creacionTarjetaInscripcion(n){var i,e=n.primerNombre,t=n.segundoNombre,a=n.primerApellido,c=n.segundoApellido,o=new Date(n.fechaInicioEduContinua),r=offsetQr?"../"+n.imagenQr:n.imagenQr;i=null!=t?e+" "+t:e;var s,l,p=a+" "+c,d=(o.getUTCDate()<10?"0"+o.getUTCDate():o.getUTCDate())+" "+meses[o.getUTCMonth()]+" "+o.getUTCFullYear();s=o.getUTCHours()<10?"0"+o.getUTCHours():o.getUTCHours(),l=o.getUTCMinutes()<10?"0"+o.getUTCMinutes():o.getUTCMinutes();var f;f=o.getUTCHours()<=11?s+":"+l+" A.M":12==o.getUTCHours()?s+":"+l+" M":s+":"+l;var u=n.educacionContinua.length>70?25:30,g=n.educacionContinua.length>70?50:80,m=new fabric.Textbox(n.educacionContinua,{fontSize:u,fontFamily:"Berlin Sans FB",textAlign:"center",fill:"#000",width:420,fixedWith:420,left:300,top:g});canvasInscripcion.add(m);var I=i.length>30?350:300;m=new fabric.Textbox(i,{fontSize:30,fontFamily:"Berlin Sans FB",textAlign:"left",fill:"#000",width:350,fixedWith:350,left:80,top:270}),canvasInscripcion.add(m),m=new fabric.Textbox(p,{fontSize:30,fontFamily:"Berlin Sans FB",textAlign:"left",fill:"#000",width:350,fixedWith:350,left:80,top:I}),canvasInscripcion.add(m),m=new fabric.Textbox(n.tipoParticipante.toUpperCase(),{fontSize:35,fontFamily:"Berlin Sans FB",textAlign:"left",fontWeight:"bold",fill:"#000",width:400,fixedWith:450,left:80,top:440}),canvasInscripcion.add(m),m=new fabric.Textbox(n.lugarEducacionContinua,{fontSize:30,fontFamily:"Berlin Sans FB",textAlign:"left",fill:"#000",width:700,fixedWith:700,left:80,top:600}),canvasInscripcion.add(m),m=new fabric.Textbox("Lugar",{fontSize:27,fontFamily:"Berlin Sans FB",fontStyle:"italic",textAlign:"left",fill:"#818386",width:100,fixedWith:150,left:80,top:640}),canvasInscripcion.add(m),m=new fabric.Textbox(d,{fontSize:30,fontFamily:"Berlin Sans FB",textAlign:"left",fill:"#000",width:400,fixedWith:450,left:80,top:690}),canvasInscripcion.add(m),m=new fabric.Textbox("Fecha Inicio",{fontSize:27,fontFamily:"Berlin Sans FB",fontStyle:"italic",textAlign:"left",fill:"#818386",width:400,fixedWith:400,left:80,top:720}),canvasInscripcion.add(m),m=new fabric.Textbox(f,{fontSize:30,fontFamily:"Berlin Sans FB",textAlign:"left",fill:"#000",width:400,fixedWith:450,left:450,top:690}),canvasInscripcion.add(m),m=new fabric.Textbox("Hora Inicio",{fontSize:27,fontFamily:"Berlin Sans FB",fontStyle:"italic",textAlign:"left",fill:"#818386",width:400,fixedWith:400,left:450,top:720}),canvasInscripcion.add(m),fabric.Image.fromURL(r,function(i){canvasInscripcion.add(i.set({left:430,top:220}));var e=canvasInscripcion.toDataURL({format:"jpg",quality:.8});guardarTarjeta(dataURItoBlob(e),n.id),clearCanvas()})}function guardarTarjeta(n,i){var e=new FormData,t=new File([n],"tarjeta.jpg",{type:"image/jpg"});e.append("file",t),e.append("idParticipante",i),$.ajax({headers:{"X-CSRF-TOKEN":token},url:contextPath+"/preinscripcion/generar-tarjeta-inscripcion",type:"POST",data:e,enctype:"multipart/form-data",processData:!1,contentType:!1,cache:!1,success:function(n){var i=document.getElementById("btn_inscripcion");null!=i?(toastr.success("Se ha realizado la inscripción con éxito","Excelente!"),$("#modalPreinscripcion").modal("hide"),i.innerHTML="CANCELAR INSCRIPCIÓN!",i.setAttribute("onclick","cancelarInscripcion()"),hideSpinnerInscripcion()):reloadListPonentes(),loadCantidadInscritos()},error:function(n){console.error(n)}})}function cancelarInscripcion(){showSpinnerInscripcion(),ajaxCancelarInscripcion()}function ajaxCancelarInscripcion(){$.ajax({headers:{"X-CSRF-TOKEN":token},type:"GET",contentType:"application/json; charset=utf-8",url:contextPath+"/preinscripcion/cancelar-inscripcion/"+idEduContinua,cache:!1,success:function(n){toastr.success("Se ha cancelado la inscripción con éxito","Excelente!");var i=document.getElementById("btn_inscripcion");i.innerHTML="INSCRÍBETE!",i.setAttribute("onclick","realizarInscripcion()"),hideSpinnerInscripcion(),loadCantidadInscritos()},error:function(n){toastr.error(n.responseJSON.message,"Error!"),hideSpinnerInscripcion()}})}function clearCanvas(){canvasInscripcion.clear(),createTemplateCanvasInscripcion()}function loadCantidadInscritos(){if(path.includes("preinscripcion")){var n=contextPath+"/preinscripcion/reload/"+idAccesoEduContinua;$("#div_info_educacionContinua").load(n)}}function limpiarErrores(){try{var n=document.getElementById("inputConstanciaPago");document.getElementById("errorPerfilInscripcion").innerText="",n.classList.remove("is-invalid");var i=document.getElementById("select_perfil_inscripcion");document.getElementById("errorConstanciaPagoInscripcion").innerText="",i.classList.remove("is-invalid"),document.getElementById("spanConstanciaPago").innerText="Seleccionar un archivo…"}catch(n){}}path.includes("detalles")?(imgTarjeta="../img/tarjeta_inscripcion.jpg",imgLogoUfps="../logos/logo-ufps-vertical.jpg",offsetQr=!0):(imgTarjeta="img/tarjeta_inscripcion.jpg",imgLogoUfps="logos/logo-ufps-vertical.jpg",offsetQr=!1),$(document).ready(function(){createTemplateCanvasInscripcion(),$("#modalPreinscripcion").on("show.bs.modal",function(n){$("#inputConstanciaPago").val(""),$("#select_perfil_inscripcion").val(0).trigger("change"),limpiarErrores()})});